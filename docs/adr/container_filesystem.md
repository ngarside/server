<!-- This is free and unencumbered software released into the public domain -->

# <p align=center>Container Filesystem

This document explains the filesystem hierarchy used by containers. It aims to
be equivalent to the Filesystem Hierarchy Standard version 3, with some
additional container-specific requirements.

# <p align=center>Filesystem Hierarchy

**Configuration files** are any files which are used to configure the
application as a whole. Typically these files will be read by the application on
startup. They can be either mutable or immutable and must be placed in an
application-specific directory under `/etc`, for example `/etc/gitea/*`.

**Executable files** are any executable files which are distributed with the
application. This includes both compiled binary files and interpreted script
files (providing the execute bit is set). They must always be immutable and
placed directly under `/usr/bin`, for example `/usr/bin/gitea`.

**Library files** are compiled libraries which are distributed with the
application. They must always be immutable and placed directly under `/usr/lib`,
for example `/usr/lib/libgl.so`.

**Packaged files** are non-executable data files which are distributed with the
application and cannot be modified. For example, this could include HTML files
for a static website. They must always be immutable and placed in an
application-specific directory under `/usr/share`, for example
`/usr/share/chartdb/*`.

**Private files** are non-executable data files which are generated by an
application at runtime and are exclusively usable via that application. They
must always be mutable (else they would be packaged, not generated) and placed
in an application-specific directory under `/var/lib`, for example
`/var/lib/gitea/*`.

**Shared files** are non-executable data files which are generated by an
application at runtime but can be accessed and/or modified independently of that
application. They must always be mutable (else they would be packaged, not
generated) and placed in a protocol-specific directory under `/srv`, for example
`/srv/git/*`. Note that, unlike all other types of files, these files are
organised per-protocol, not per-application, as their usage is not tied to a
specific application.

**Temporary files** are short lived files which are generated by an application
at runtime and do not need to be persisted. They must always be mutable and
placed in an application-specific directory under `/tmp`, for example
`/tmp/gitea/*`.

# <p align=center>Filesystem Mounts & Mutability

The root volume of a container must always be read-only, with only specific
directories mounted as read-write. Depending on the use case read-write volumes
may be transient, persisted to redundant storage or persisted to non-redundant
storage.

| Prefix     | Persistence             | Mutability              |
| ---------- | ----------------------- | ----------------------- |
| `/etc`     | Persistent or transient | Read-only or read-write |
| `/srv`     | Persistent              | Read-write              |
| `/var/lib` | Persistent              | Read-write              |
| `/tmp`     | Transient               | Read-write              |

# <p align=center>Simple Example - ChartDB

The ChartDB container runs the Caddy file server, which serves the ChartDB
static web application.

| Files           | Path                   |
| --------------- | ---------------------- |
| Caddy binary    | `/usr/bin/caddy`       |
| ChartDB content | `/usr/share/chartdb/*` |

# <p align=center>Complex Example - Gitea

The Gitea container runs Gitea itself, as well as its dependencies Git and
BusyBox.

| Files                       | Path                             |
| --------------------------- | -------------------------------- |
| Binary files                | `/usr/bin/(busybox\|git\|gitea)` |
| BusyBox & Git symlinks      | `/usr/bin/*`                     |
| Configuration               | `/etc/gitea/gitea.ini`           |
| Git repositories            | `/srv/git/{repository}/.git`     |
| LFS data                    | `/var/lib/gitea/lfs/*`           |
| Miscellaneous runtime files | `/var/lib/gitea/*`               |
| Temporary files             | `/tmp/gitea/*`                   |

Note that Git repositories are stored under `/srv`Â whereas LFS data is stored
under `/var/lib`. This is because Git repositories are stand alone - they are
usable outside of Gitea. Whereas LFS data is stored in a Gitea-specific format
and is therefore only accessible via Gitea.

# <p align=center>References

- [about.gitea.com](https://about.gitea.com)
- [caddyserver.com](https://caddyserver.com)
- [chartdb.io](https://chartdb.io)
- [wikipedia.org/wiki/filesystem_hierarchy_standard](
	https://wikipedia.org/wiki/filesystem_hierarchy_standard)
- [refspecs.linuxfoundation.org/FHS_3.0/fhs/index.html](
	https://refspecs.linuxfoundation.org/FHS_3.0/fhs/index.html)
